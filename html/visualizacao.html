<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualização de Câmeras e Sensores</title>
    <link rel="stylesheet" href="../css/visualizacao.css">
</head>

<body>
    <div class="visualizacao-container">
        <header>
            <h1>Visualização de Câmeras</h1>
            <button id="voltar">Voltar</button>
        </header>
        
        <section class="cameras">
            <h2>Câmeras</h2>
            <div class="camera-feed" id="camera-feed">
                <img id="stream" src="http://192.168.80.216:81/stream" alt="Feed de câmera">
            </div>
            <div class="area-selector">
                <button onclick="selectArea('sala')">Sala de Estar</button>
                <button onclick="selectArea('cozinha')">Cozinha</button>
                <button onclick="selectArea('quarto')">Quarto</button>
                <button onclick="selectArea('garagem')">Garagem</button>
            </div>
        </section>

        <div class="dashboard-container">
            <section class="status-section">
                <h2>Status das Áreas</h2>
                <div class="area-status">
                    <div class="area" id="area-living-room">
                        <h3>Sala de Estar</h3>
                        <p class="status">Tudo normal</p>
                    </div>
                    <div class="area" id="area-kitchen">
                        <h3>Cozinha</h3>
                        <p class="status alert">Alerta em Cozinha</p>
                    </div>
                    <div class="area" id="area-bedroom">
                        <h3>Quarto</h3>
                        <p class="status">Tudo normal</p>
                    </div>
                    <div class="area" id="area-garage">
                        <h3>Garagem</h3>
                        <p class="status">Tudo normal</p>
                    </div>
                </div>
            </section>
    
            <section class="log-section">
                <h2>Log de Atividades</h2>
                <ul id="activity-log">
                    <li>12:30 - Movimento detectado na Sala de Estar.</li>
                    <li>12:15 - Sensor de fumaça ativado na Cozinha.</li>
                    <li>12:00 - Câmera da Garagem ativada.</li>
                </ul>
            </section>
        </div>

        <!-- Botão de teste para envio de alerta -->
        <button id="enviar-alerta">Enviar Alerta</button>
    </div>

    <script src="../js/visualizacao.js"></script>
    <script>
        // Redirecionar para a página de sidebar
        document.getElementById('voltar').addEventListener('click', function () {
            window.location.href = "../html/sidebar.html";
        });

        // Atualizar log de atividades
        function updateActivityLog(message) {
            const log = document.getElementById('activity-log');
            const newLogEntry = document.createElement('li');
            newLogEntry.textContent = message;
            log.prepend(newLogEntry);
        }

        setTimeout(() => {
            updateActivityLog("13:00 - Movimento detectado na Cozinha.");
        }, 5000);

        // Função para simular o envio de mensagens
        async function enviarMensagemAlerta() {
            const backendUrl = "http://localhost:3000/enviar-mensagem";

            const mensagem = {
                numero: "5511999999999", // Número no formato internacional
                mensagem: "⚠️ Alerta: Movimento detectado na Sala de Estar!",
            };

            try {
                const resposta = await fetch(backendUrl, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(mensagem),
                });

                const dados = await resposta.json();
                console.log("Mensagem enviada com sucesso:", dados);
                updateActivityLog("Mensagem enviada: Alerta enviado para o WhatsApp.");
            } catch (erro) {
                console.error("Erro ao enviar mensagem:", erro);
                updateActivityLog("Erro ao enviar mensagem de alerta.");
            }
        }

        // Adiciona funcionalidade ao botão "Enviar Alerta"
        document.getElementById('enviar-alerta').addEventListener('click', () => {
            enviarMensagemAlerta();
        });
    </script>
</body>
</html>
